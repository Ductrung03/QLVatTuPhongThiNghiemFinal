@{
    ViewData["Title"] = "Lịch thực hành theo tháng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-body">
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-6">
                    <h3>Lịch thực hành theo tháng</h3>
                </div>
                <div class="col-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="@Url.Action("Index", "Dashboard")">
                                <i data-feather="home"></i>
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="@Url.Action("Index", "LichThucHanh")">Lịch thực hành</a>
                        </li>
                        <li class="breadcrumb-item active">Lịch theo tháng</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col-sm-12">
                <div class="d-flex justify-content-between">
                    <div>
                        <a href="@Url.Action("Create", "LichThucHanh")" class="btn btn-success">
                            <i data-feather="plus"></i> Đăng ký lịch mới
                        </a>
                        <a href="@Url.Action("Index", "LichThucHanh")" class="btn btn-secondary">
                            <i data-feather="list"></i> Xem danh sách
                        </a>
                    </div>
                    <div>
                        <input type="month" id="monthSelector" class="form-control" style="width: auto; display: inline-block;" />
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header bg-primary">
                        <h5 class="text-white mb-0">
                            <i data-feather="calendar" class="me-2"></i>Lịch thực hành tháng <span id="currentMonth"></span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="calendar-container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="calendar-grid">
                                        <div class="calendar-header">
                                            <div class="day-header">Chủ nhật</div>
                                            <div class="day-header">Thứ hai</div>
                                            <div class="day-header">Thứ ba</div>
                                            <div class="day-header">Thứ tư</div>
                                            <div class="day-header">Thứ năm</div>
                                            <div class="day-header">Thứ sáu</div>
                                            <div class="day-header">Thứ bảy</div>
                                        </div>
                                        <div id="calendar-body">
                                            <!-- Calendar days will be generated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="row mt-3">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <h6>Chú thích:</h6>
                        <div class="d-flex flex-wrap">
                            <div class="me-3 mb-2">
                                <span class="badge bg-primary me-1"></span> Chờ duyệt
                            </div>
                            <div class="me-3 mb-2">
                                <span class="badge bg-success me-1"></span> Đã duyệt
                            </div>
                            <div class="me-3 mb-2">
                                <span class="badge bg-warning me-1"></span> Đang thực hiện
                            </div>
                            <div class="me-3 mb-2">
                                <span class="badge bg-info me-1"></span> Hoàn thành
                            </div>
                            <div class="me-3 mb-2">
                                <span class="badge bg-danger me-1"></span> Đã hủy
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Script {
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #dee2e6;
            border: 1px solid #dee2e6;
        }

        .calendar-header {
            display: contents;
        }

        .day-header {
            background-color: #343a40;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .calendar-day {
            background-color: white;
            min-height: 120px;
            padding: 5px;
            position: relative;
            border: 1px solid #dee2e6;
        }

            .calendar-day.other-month {
                background-color: #f8f9fa;
                color: #6c757d;
            }

            .calendar-day.today {
                background-color: #fff3cd;
            }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .schedule-item {
            font-size: 10px;
            padding: 2px 4px;
            margin-bottom: 2px;
            border-radius: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>

    <script>
        let currentDate = new Date();

        $(document).ready(function() {
            feather.replace();

            // Set current month in selector
            const monthInput = document.getElementById('monthSelector');
            monthInput.value = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');

            // Load calendar
            loadCalendar(currentDate.getFullYear(), currentDate.getMonth());

            // Month selector change
            monthInput.addEventListener('change', function() {
                const [year, month] = this.value.split('-');
                currentDate = new Date(year, month - 1, 1);
                loadCalendar(year, month - 1);
            });
        });

        function loadCalendar(year, month) {
            updateMonthDisplay(year, month);
            generateCalendarDays(year, month);
            loadScheduleData(year, month);
        }

        function updateMonthDisplay(year, month) {
            const monthNames = [
                "1", "2", "3", "4", "5", "6",
                "7", "8", "9", "10", "11", "12"
            ];
            document.getElementById('currentMonth').textContent = `${monthNames[month]}/${year}`;
        }

        function generateCalendarDays(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarBody = document.getElementById('calendar-body');
            calendarBody.innerHTML = '';

            const today = new Date();

            for (let i = 0; i < 42; i++) {
                const currentDay = new Date(startDate);
                currentDay.setDate(startDate.getDate() + i);

                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.dataset.date = currentDay.toISOString().split('T')[0];

                if (currentDay.getMonth() !== month) {
                    dayDiv.classList.add('other-month');
                }

                if (currentDay.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }

                dayDiv.innerHTML = `<div class="day-number">${currentDay.getDate()}</div>`;
                calendarBody.appendChild(dayDiv);
            }
        }

        function loadScheduleData(year, month) {
            // Simulate loading schedule data
            setTimeout(() => {
                const days = document.querySelectorAll('.calendar-day');
                days.forEach(day => {
                    // Add some sample schedule items
                    if (Math.random() > 0.7) {
                        const scheduleItem = document.createElement('div');
                        scheduleItem.className = 'schedule-item badge bg-primary';
                        scheduleItem.textContent = 'Lịch thực hành';
                        day.appendChild(scheduleItem);
                    }
                });
            }, 500);
        }
    </script>
}